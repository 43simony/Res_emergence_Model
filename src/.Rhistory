out
}
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 500000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 20, gen_step = 1,
verbose = 2, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+4
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 500000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 25, gen_step = 1,
verbose = 2, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+4
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 500000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc-tic
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 25, gen_step = 1,
verbose = 1, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+3
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
toc-tic
## get total extinction diagnostics
ext_data = read.table(paste0("./simulation_files/", pars$batchname, "_extinction.txt"), header = TRUE, sep = ";", check.names = FALSE) %>% mutate_all(as.numeric)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
toc-tic
## get total extinction diagnostics
ext_data = read.table(paste0("./simulation_files/", pars$batchname, "_extinction.txt"), header = TRUE, sep = ";", check.names = FALSE) %>% mutate_all(as.numeric)
print(ext_data)
21/17
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 1000000, gen_step = 1,
verbose = 1, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+3
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
toc-tic
## get total extinction diagnostics
ext_data = read.table(paste0("./simulation_files/", pars$batchname, "_extinction.txt"), header = TRUE, sep = ";", check.names = FALSE) %>% mutate_all(as.numeric)
print(ext_data)
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 1000000, gen_step = 1,
verbose = 2, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+3
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
# ---------------------------
# Wrapper for calling your C++ binary simulation
# Modify path/f_name.exe as necessary for current WD
# ---------------------------
multiType_BP_withTreat <- function(n_reps, type_pars, site_pars, parameters, exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL) {
parvec <- c(n_reps,
parameters$n_drugs, # number of independent drugs/mutation sites
parameters$T_max, # max generation number
parameters$N_max, # critical population size
parameters$gen_step, # steps between output values
parameters$verbose, # debugging error output
parameters$data_out, # print to console: 0; otherwise print to file
parameters$batchname, # name element for output / error files
parameters$par_dat # specified name for parameter file
)
strvec <- format(parvec, digits = 5, scientific = FALSE)
# Optionally change working directory for the run
oldwd <- getwd()
if (!is.null(run_dir)) setwd(run_dir)
## generate parameter file for vectorized parameters
write.table(type_pars, file = paste0("./simulation_files/", parameters$par_dat, ".txt"), sep = ",", row.names = FALSE, col.names = FALSE)
write.table(site_pars, file = paste0("./simulation_files/", parameters$par_dat, ".txt"), sep = ",", row.names = FALSE, col.names = FALSE, append = TRUE)
## print command line statement for comparison
if(parameters$verbose > 1){ print( paste(shQuote(exe_path), paste(strvec, collapse = " ")) ) }
## Run .exe
if (parameters$data_out == 0) {
# capture console output
res <- system2(exe_path, args = strvec, stdout = TRUE)
out <- read.table(text = res, header = TRUE, sep = ";", check.names = FALSE) %>%
mutate_all(as.numeric)
} else {
# read from output file
res <- system2(exe_path, args = strvec, stdout = FALSE)
out_file <- paste0("./simulation_files/", parameters$batchname, "_results.txt")
# wait a moment if needed for file to be written
# Sys.sleep(0.1)
out <- read.table(out_file, header = TRUE, sep = ";", check.names = FALSE) %>%
mutate_all(as.numeric)
}
if (!is.null(run_dir)) setwd(oldwd)
out
}
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 1000000, gen_step = 1,
verbose = 2, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+3
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
# ---------------------------
# Wrapper for calling your C++ binary simulation
# Modify path/f_name.exe as necessary for current WD
# ---------------------------
multiType_BP_withTreat <- function(n_reps, type_pars, site_pars, parameters, exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL) {
parvec <- c(format(n_reps, scientific = FALSE),
parameters$n_drugs, # number of independent drugs/mutation sites
parameters$T_max, # max generation number
format(parameters$N_max, scientific = FALSE), # critical population size
parameters$gen_step, # steps between output values
parameters$verbose, # debugging error output
parameters$data_out, # print to console: 0; otherwise print to file
parameters$batchname, # name element for output / error files
parameters$par_dat # specified name for parameter file
)
strvec <- format(parvec, digits = 5)
# Optionally change working directory for the run
oldwd <- getwd()
if (!is.null(run_dir)) setwd(run_dir)
## generate parameter file for vectorized parameters
write.table(type_pars, file = paste0("./simulation_files/", parameters$par_dat, ".txt"), sep = ",", row.names = FALSE, col.names = FALSE)
write.table(site_pars, file = paste0("./simulation_files/", parameters$par_dat, ".txt"), sep = ",", row.names = FALSE, col.names = FALSE, append = TRUE)
## print command line statement for comparison
if(parameters$verbose > 1){ print( paste(shQuote(exe_path), paste(strvec, collapse = " ")) ) }
## Run .exe
if (parameters$data_out == 0) {
# capture console output
res <- system2(exe_path, args = strvec, stdout = TRUE)
out <- read.table(text = res, header = TRUE, sep = ";", check.names = FALSE) %>%
mutate_all(as.numeric)
} else {
# read from output file
res <- system2(exe_path, args = strvec, stdout = FALSE)
out_file <- paste0("./simulation_files/", parameters$batchname, "_results.txt")
# wait a moment if needed for file to be written
# Sys.sleep(0.1)
out <- read.table(out_file, header = TRUE, sep = ";", check.names = FALSE) %>%
mutate_all(as.numeric)
}
if (!is.null(run_dir)) setwd(oldwd)
out
}
# ---------------------------
# Function to generate initial state vector,
## returned using bitmap ordering
## for consistency with simulation code
# K defines the number of drugs (so # classes = 2^K)
# init_size is a data frame for known initial states {WT, M1, ... MXX}
## values not included are assumed to be 0
# ---------------------------
make_initial_pop <- function(K, init_size = data.frame(), b_vec, d_vec) {
# number of genotypes
n_geno <- 2^K
# generate bitmask labels
bitmask_labels <- sapply(0:(n_geno - 1), function(mask) {
if (mask == 0) {
"WT"
} else {
mutated_sites <- which(intToBits(mask)[1:K] == 1)
paste0("M", paste(mutated_sites, collapse = ""))
}
})
# initialize all counts as zero
counts <- setNames(rep(0, n_geno), bitmask_labels)
# check that init_size has correct column names
if (!missing(init_size) && ncol(init_size) > 0) {
provided_names <- colnames(init_size)
bad_names <- setdiff(provided_names, bitmask_labels)
# warn if names don't match
if (length(bad_names) > 0) {
warning("Ignoring invalid initial states: ", paste(bad_names, collapse = ", "))
}
# assign matching values
good_names <- intersect(provided_names, bitmask_labels)
counts[good_names] <- init_size[1, good_names]
}
# return as a one-row data frame
# reorder b_vec and d_vec to match counts
b_vec_ord <- b_vec[names(counts)]
d_vec_ord <- d_vec[names(counts)]
# construct final 3-row data frame
df <- rbind(
N = counts,
b = b_vec_ord,
d = d_vec_ord
)
return(df)
}
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
toc-tic
## get total extinction diagnostics
ext_data = read.table(paste0("./simulation_files/", pars$batchname, "_extinction.txt"), header = TRUE, sep = ";", check.names = FALSE) %>% mutate_all(as.numeric)
print(ext_data)
# --- Simulation data ---
sim_df <- out_df %>%
filter(Gen == Gen_val) %>%
select(all_of(type_names[type_idx]))
# Collapse into counts if multivariate
sim_counts <- sim_df %>%
count(across(everything()), name = "freq") %>%
mutate(prob = freq / sum(freq))
sum(out$M123)
gc()
N_init = data.frame(WT = 1)
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 1000000, gen_step = 1,
verbose = 2, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
# ---------------------------
# Wrapper for calling your C++ binary simulation
# Modify path/f_name.exe as necessary for current WD
# ---------------------------
multiType_BP_withTreat <- function(n_reps, type_pars, site_pars, parameters, exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL) {
parvec <- c(format(n_reps, scientific = FALSE),
parameters$n_drugs, # number of independent drugs/mutation sites
parameters$T_max, # max generation number
format(parameters$N_max, scientific = FALSE), # critical population size
parameters$gen_step, # steps between output values
parameters$verbose, # debugging error output
parameters$data_out, # print to console: 0; otherwise print to file
parameters$batchname, # name element for output / error files
parameters$par_dat # specified name for parameter file
)
strvec <- format(parvec, digits = 5)
# Optionally change working directory for the run
oldwd <- getwd()
if (!is.null(run_dir)) setwd(run_dir)
## generate parameter file for vectorized parameters
write.table(type_pars, file = paste0("./simulation_files/", parameters$par_dat, ".txt"), sep = ",", row.names = FALSE, col.names = FALSE)
write.table(site_pars, file = paste0("./simulation_files/", parameters$par_dat, ".txt"), sep = ",", row.names = FALSE, col.names = FALSE, append = TRUE)
## print command line statement for comparison
if(parameters$verbose > 1){ print( paste(shQuote(exe_path), paste(strvec, collapse = " ")) ) }
## Run .exe
if (parameters$data_out == 0) {
# capture console output
res <- system2(exe_path, args = strvec, stdout = TRUE)
out <- read.table(text = res, header = TRUE, sep = ";", check.names = FALSE) %>%
mutate_all(as.numeric)
} else {
# read from output file
res <- system2(exe_path, args = strvec, stdout = FALSE)
out_file <- paste0("./simulation_files/", parameters$batchname, "_results.txt")
# wait a moment if needed for file to be written
# Sys.sleep(0.1)
out <- read.table(out_file, header = TRUE, sep = ";", check.names = FALSE) %>%
mutate_all(as.numeric)
}
if (!is.null(run_dir)) setwd(oldwd)
out
}
# ---------------------------
# Function to generate initial state vector,
## returned using bitmap ordering
## for consistency with simulation code
# K defines the number of drugs (so # classes = 2^K)
# init_size is a data frame for known initial states {WT, M1, ... MXX}
## values not included are assumed to be 0
# ---------------------------
make_initial_pop <- function(K, init_size = data.frame(), b_vec, d_vec) {
# number of genotypes
n_geno <- 2^K
# generate bitmask labels
bitmask_labels <- sapply(0:(n_geno - 1), function(mask) {
if (mask == 0) {
"WT"
} else {
mutated_sites <- which(intToBits(mask)[1:K] == 1)
paste0("M", paste(mutated_sites, collapse = ""))
}
})
# initialize all counts as zero
counts <- setNames(rep(0, n_geno), bitmask_labels)
# check that init_size has correct column names
if (!missing(init_size) && ncol(init_size) > 0) {
provided_names <- colnames(init_size)
bad_names <- setdiff(provided_names, bitmask_labels)
# warn if names don't match
if (length(bad_names) > 0) {
warning("Ignoring invalid initial states: ", paste(bad_names, collapse = ", "))
}
# assign matching values
good_names <- intersect(provided_names, bitmask_labels)
counts[good_names] <- init_size[1, good_names]
}
# return as a one-row data frame
# reorder b_vec and d_vec to match counts
b_vec_ord <- b_vec[names(counts)]
d_vec_ord <- d_vec[names(counts)]
# construct final 3-row data frame
df <- rbind(
N = counts,
b = b_vec_ord,
d = d_vec_ord
)
return(df)
}
## function to generate a default named vector
#### for use in make_initial_pop (b_vec and d_vec)
makeLabels_vec <- function(K) {
# number of genotypes
n_geno <- 2^K
# generate all masks
masks <- 0:(n_geno - 1)
# turn masks into labels
labels <- sapply(masks, function(mask) {
if (mask == 0) {
"WT"
} else {
mutated_sites <- which(as.integer(intToBits(mask))[1:K] == 1)
paste0("M", paste(mutated_sites, collapse = ""))
}
})
# compute Hamming weights
hamming_weights <- sapply(masks, function(mask) sum(as.integer(intToBits(mask))[1:K]))
# order by weight, then lexicographically
order_idx <- order(hamming_weights, labels)
labels <- labels[order_idx]
return(setNames(rep(0, length(labels)), labels))
}
##############################
##############################
### Test model Evaluation  ###
##############################
##############################
N_init = data.frame(WT = 1)
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 1000000, gen_step = 1,
verbose = 2, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+3
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
toc-tic
## get total extinction diagnostics
ext_data = read.table(paste0("./simulation_files/", pars$batchname, "_extinction.txt"), header = TRUE, sep = ";", check.names = FALSE) %>% mutate_all(as.numeric)
print(ext_data)
# --- Simulation data ---
sim_df <- out_df %>%
filter(Gen == Gen_val) %>%
select(all_of(type_names[type_idx]))
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 1000000, gen_step = 1,
verbose = 1, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+3
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
toc-tic
## get total extinction diagnostics
ext_data = read.table(paste0("./simulation_files/", pars$batchname, "_extinction.txt"), header = TRUE, sep = ";", check.names = FALSE) %>% mutate_all(as.numeric)
print(ext_data)
pars <- data.frame(n_drugs = 3, T_max = 20, N_max = 1000000, gen_step = 1,
verbose = 1, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+3
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
toc-tic
## get total extinction diagnostics
ext_data = read.table(paste0("./simulation_files/", pars$batchname, "_extinction.txt"), header = TRUE, sep = ";", check.names = FALSE) %>% mutate_all(as.numeric)
print(ext_data)
log(base = 2, 1000000)
## note that worst case it is irrelevant / unadvised to go past 30 gens due to overflow in critical cases
## (and practically, patient death, in terms of bacterial population sizes)
pars <- data.frame(n_drugs = 3, T_max = 30, N_max = 1000000, gen_step = 1,
verbose = 1, data_out = 1, batchname = 'test', par_dat = 'testPars')
data.frame( mu = replicate(pars$n_drugs, 1e-3),
k = replicate(pars$n_drugs, 1) ## k-fold increase in mortality (use 1 for no treatment)
) %>% t() %>% as.data.frame() -> site_pars
b_vec = makeLabels_vec(pars$n_drugs)
b_vec = b_vec+3
d_vec = makeLabels_vec(pars$n_drugs)
d_vec = d_vec+1
type_pars = make_initial_pop(K = pars$n_drugs, init_size = N_init, b_vec = b_vec, d_vec = d_vec)
tic = Sys.time()
out = multiType_BP_withTreat(n_reps = 50000,
type_pars = type_pars, site_pars = site_pars,
parameters = pars,
exe_path = "./multiType_BP_withTreat.exe", run_dir = NULL)
toc = Sys.time()
toc-tic
## get total extinction diagnostics
ext_data = read.table(paste0("./simulation_files/", pars$batchname, "_extinction.txt"), header = TRUE, sep = ";", check.names = FALSE) %>% mutate_all(as.numeric)
print(ext_data)
# --- Simulation data ---
sim_df <- out_df %>%
filter(Gen == Gen_val) %>%
select(all_of(type_names[type_idx]))
sum(out$M123)
